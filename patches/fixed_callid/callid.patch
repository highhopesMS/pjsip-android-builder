--- pjsip/include/pjsip-ua/sip_regc.h.orig	2024-01-01 00:00:00.000000000 +0000
+++ pjsip/include/pjsip-ua/sip_regc.h	2024-01-01 00:00:00.000000000 +0000
@@ -222,7 +222,8 @@
                                      const pj_str_t *to_url,
                                      int ccnt,
                                      const pj_str_t contact[],
-                                     pj_uint32_t expires);
+                                     pj_uint32_t expires,
+                                     const pj_str_t *cid);


 /**
--- pjsip/include/pjsua-lib/pjsua.h.orig	2024-01-01 00:00:00.000000000 +0000
+++ pjsip/include/pjsua-lib/pjsua.h	2024-01-01 00:00:00.000000000 +0000
@@ -4074,6 +4074,14 @@
      * This field is mandatory.
      */
     pj_str_t        id;
+
+    /**
+     * The Call ID used in REGISTER. If the value is empty, a random generated
+     * value will be used.
+     *
+     * This field is optional.
+     */
+    pj_str_t        call_id;

     /**
      * This is the URL to be put in the request URI for the registration,
--- pjsip/include/pjsua2/account.hpp.orig	2024-01-01 00:00:00.000000000 +0000
+++ pjsip/include/pjsua2/account.hpp	2024-01-01 00:00:00.000000000 +0000
@@ -190,6 +190,14 @@
      */
     unsigned            proxyUse;

+    /**
+     * This value will be used to set the registration Call-ID
+     * if not present the library will generate a random unique value
+     *
+     * The parameters should be a string of 32 alphanumeric chars
+     */
+    string              callID;
+
 public:
     /**
      * Read this object from a container node.
--- pjsip/src/pjsip-ua/sip_reg.c.orig	2024-01-01 00:00:00.000000000 +0000
+++ pjsip/src/pjsip-ua/sip_reg.c	2024-01-01 00:00:00.000000000 +0000
@@ -352,7 +352,8 @@
                                      const pj_str_t *to_url,
                                      int contact_cnt,
                                      const pj_str_t contact[],
-                                     pj_uint32_t expires)
+                                     pj_uint32_t expires,
+                                     const pj_str_t *cid)
 {
     pj_str_t tmp;
     pj_status_t status;
@@ -405,7 +406,12 @@

     /* Set "Call-ID" header. */
     regc->cid_hdr = pjsip_cid_hdr_create(regc->pool);
-    pj_create_unique_string(regc->pool, &regc->cid_hdr->id);
+    if (cid && cid->slen > 0) {
+        pj_strdup_with_null(regc->pool, &regc->cid_hdr->id, cid);
+        PJ_LOG(4,(THIS_FILE, "regc: callID %.*s", (int)regc->cid_hdr->id.slen, regc->cid_hdr->id.ptr));
+    } else {
+        pj_create_unique_string(regc->pool, &regc->cid_hdr->id);
+    }

     /* Set "CSeq" header. */
     regc->cseq_hdr = pjsip_cseq_hdr_create(regc->pool);
--- pjsip/src/pjsua-lib/pjsua_acc.c.orig	2024-01-01 00:00:00.000000000 +0000
+++ pjsip/src/pjsua-lib/pjsua_acc.c	2024-01-01 00:00:00.000000000 +0000
@@ -95,6 +95,7 @@
     pj_strdup_with_null(pool, &dst->contact_uri_params,
                         &src->contact_uri_params);
     pj_strdup_with_null(pool, &dst->pidf_tuple_id, &src->pidf_tuple_id);
+    pj_strdup_with_null(pool, &dst->call_id, &src->call_id);
     pj_strdup_with_null(pool, &dst->rfc5626_instance_id,
                         &src->rfc5626_instance_id);
     pj_strdup_with_null(pool, &dst->rfc5626_reg_id, &src->rfc5626_reg_id);
--- pjsip/src/pjsua-lib/pjsua_core.c.orig	2024-01-01 00:00:00.000000000 +0000
+++ pjsip/src/pjsua-lib/pjsua_core.c	2024-01-01 00:00:00.000000000 +0000
@@ -335,6 +335,8 @@

     pj_bzero(cfg, sizeof(*cfg));

+    cfg->call_id = pj_str("");
+
     cfg->reg_timeout = PJSUA_REG_INTERVAL;
     cfg->reg_delay_before_refresh = PJSIP_REGISTER_CLIENT_DELAY_BEFORE_REFRESH;
     cfg->unreg_timeout = PJSUA_UNREG_TIMEOUT;
--- pjsip/src/pjsua2/account.cpp.orig	2024-01-01 00:00:00.000000000 +0000
+++ pjsip/src/pjsua2/account.cpp	2024-01-01 00:00:00.000000000 +0000
@@ -313,6 +313,7 @@
     NODE_READ_UNSIGNED  (this_node, unregWaitMsec);
     NODE_READ_UNSIGNED  (this_node, proxyUse);
     NODE_READ_STRING    (this_node, contactParams);
+    NODE_READ_STRING    (this_node, callID);

     readSipHeaders(this_node, "headers", headers);
 }
@@ -333,6 +334,7 @@
     NODE_WRITE_UNSIGNED (this_node, unregWaitMsec);
     NODE_WRITE_UNSIGNED (this_node, proxyUse);
     NODE_WRITE_STRING   (this_node, contactParams);
+    NODE_WRITE_STRING   (this_node, callID);

     writeSipHeaders(this_node, "headers", headers);
 }
@@ -688,6 +690,7 @@
     ret.drop_calls_on_reg_fail  = regConfig.dropCallsOnFail;
     ret.unreg_timeout           = regConfig.unregWaitMsec;
     ret.reg_use_proxy           = regConfig.proxyUse;
+    ret.call_id                 = str2Pj(regConfig.callID);
     ret.reg_contact_params      = str2Pj(regConfig.contactParams);
     ret.reg_contact_uri_params  = str2Pj(regConfig.contactUriParams);
     for (i=0; i<regConfig.headers.size(); ++i) {
@@ -874,6 +877,7 @@
     regConfig.dropCallsOnFail   = PJ2BOOL(prm.drop_calls_on_reg_fail);
     regConfig.unregWaitMsec     = prm.unreg_timeout;
     regConfig.proxyUse          = prm.reg_use_proxy;
+    regConfig.callID            = pj2Str(prm.call_id);
     regConfig.contactParams     = pj2Str(prm.reg_contact_params);
     regConfig.contactUriParams  = pj2Str(prm.reg_contact_uri_params);
     regConfig.headers.clear();
--- pjsip/src/test/regc_test.c.orig	2024-01-01 00:00:00.000000000 +0000
+++ pjsip/src/test/regc_test.c	2024-01-01 00:00:00.000000000 +0000
@@ -298,8 +298,8 @@
     if (status != PJ_SUCCESS)
         return -100;

-    status = pjsip_regc_init(regc, registrar_uri, &aor, &aor, contact_cnt,
-                             contacts, expires ? expires : 60);
+    status = pjsip_regc_init(regc, registrar_uri, &aor, &aor, contact_cnt,
+                             contacts, expires ? expires : 60, NULL);
     if (status != PJ_SUCCESS) {
         pjsip_regc_destroy(regc);
         return -110;
